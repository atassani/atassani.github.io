(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.radar={},t.d3)})(this,function(t,u){"use strict";var e=[["V","Visualise"],["W","Limit WIP"],["F","Manage Flow"],["P","Explicit Policies"],["L","Feedback loops"],["I","Improve"],["E","Effects"]],a=e.map(function(t){return[t[1],t[0]]}),r=new Map(e),n=new Map(a);var o,l,p,s=960,c=600,f=Math.min(s,c)/2-10,d=[1,1,1,1,1,1,1];var i,m,v=u.scaleOrdinal(u.schemeCategory10),x=u.timeFormat("%a %b %e %Y %H:%M");function g(i,o,t){var e=f/3-10-10,a=f/3-10+28,r=f/3*2-10-28,n=f/3*2-10+28,l=f/3*3-10-28,s=Array.from(radar.areas.values()).indexOf(i),c={angleScale:u.scaleLinear().domain([0,1]).range([p[s].startAngle,p[s].endAngle]),radiusScale:new Map([["2",u.scaleLinear().domain([0,1]).range([40,e])],["1",u.scaleLinear().domain([0,1]).range([a,r])],["0",u.scaleLinear().domain([0,1]).range([n,l])]])},d=[];return t&&t.forEach(function(t){var e=radar.random(),a=radar.random(),r=v(s);0==o&&(r=u.color(r).brighter(1)),2==o&&(r=u.color(r).darker(1));var n=new h(radar.reverseAreas.get(i),t.value,r,t.trend,Math.sin(c.angleScale(e))*c.radiusScale.get(o+"")(a)+(.5<e?-1:1)*Math.cos(c.angleScale(e))*10,-Math.cos(c.angleScale(e))*c.radiusScale.get(o+"")(a)+(.5<e?-1:1)*Math.sin(c.angleScale(e))*10);d.push(n)}),d}function h(t,e,a,r,n,i){this.area=t,this.number=e,this.color=a,this.trend=r,this.x=n,this.y=i}function y(t,e,a){m=e,A(a)}function A(t){(function(t){u.select("svg>g").append("g").attr("id","dataPoints"),function(t){var e=M(t,"U");P(e,"90"),k(e)}(t),function(t){var e=M(t,"D");P(e,"-90"),k(e)}(t),function(t){var e=M(t,"");(function(t){t.append("circle").attr("r","8px").attr("fill",function(t){return t.color}).attr("stroke",function(t){return u.color(t.color).darker(.5)}).attr("stroke-width",3)})(e),k(e)}(t)})(function(t,e){for(var a=e[t],r=Object.keys(a.Areas),n=[],i=0;i<r.length;i++)for(var o=r[i],l=0;l<=2;l++)n=n.concat(g(o,l,a.Areas[o][l]));return n}(t,i))}function w(t,e){document.getElementById("teamName").innerText=t,document.getElementById("date").innerText=x(new Date(e[t].Date)),e[t].DatePrevious&&(document.getElementById("date").innerText+=" (previous "+x(new Date(e[t].DatePrevious))+")")}function b(){var t=u.select("select").property("value");u.selectAll("#dataPoints").remove(),radar.randomSeed=1,w(t,i),A(t)}function M(t,e){return u.select("#dataPoints").selectAll("g").data(t.filter(function(t){return t.trend==e}),function(t){return"dataPoint"+t.area+t.number}).enter().append("g").attr("id",function(t,e){return e}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("mouseover",function(t){(function(t,e){var a=u.select("#questions"),r=m[t+e];a.transition().duration(200).style("opacity",.9),a.html("<strong>"+r.question+"</strong><br/>"+r.answer0+"<br/>"+r.answer1+"<br/>"+r.answer2).style("left",u.event.pageX+14+"px").style("top",u.event.pageY-25+"px")})(t.area,t.number)}).on("mouseout",j)}function P(t,e){var a=u.symbol().type(u.symbolTriangle).size(200);t.append("path").attr("d",a).attr("transform","rotate("+e+")").attr("fill",function(t){return t.color}).attr("stroke",function(t){return u.color(t.color).darker(.5)}).attr("stroke-width",3)}function k(t){t.append("text").attr("dx",function(t){return 10<=t.number?"-0.66em":"-0.33em"}).attr("dy","0.33em").attr("class","numbers").attr("transform","rotate(90)").text(function(t,e){return t.number})}function j(){u.select("#questions").transition().duration(500).style("opacity",0)}var D=1;t.version="1.0.0",t.loadData=function(r,t){u.json("data/teams.json",function(t,e){console.log(a);var a=e;radar.drawChart(),radar.paintPoints(r,a)})},t.areas=r,t.reverseAreas=n,t.drawChart=function(){(function(){u.select("#chart").append("svg").attr("width",s).attr("height",c).append("g").attr("transform","translate("+s/2+","+c/2+")rotate(-90)").attr("id","radar"),u.select("body").append("div").attr("id","questions").attr("class","floatingQuestion").style("opacity",0);var t=u.pie().padAngle(.05),e=u.arc().outerRadius(f/3-10).innerRadius(8),a=u.select("#radar").append("g").attr("id","pie");p=t(d);var r=a.selectAll(".internalArc").data(t(d)).enter().append("g").attr("class","internalArc");r.append("path").attr("d",e).style("fill","#9c9c9c").attr("class","internalArc");var n=u.pie().padAngle(.02),i=u.arc().outerRadius(f/3*2-10).innerRadius(f/3-10);(r=a.selectAll(".mediumArc").data(n(d)).enter().append("g").attr("class","mediumArc")).append("path").attr("d",i).style("fill","#afafaf").attr("class","mediumArc"),o=u.pie().padAngle(.013),l=u.arc().outerRadius(f/3*3-10).innerRadius(f/3*2-10),a.selectAll(".externalArc").data(o(d)).enter().append("g").attr("class","externalArc")})(),function(){var i=u.select("#radar").append("g").attr("id","externalTitles");u.selectAll(".externalArc").append("path").attr("d",l).style("fill","#ccc").attr("class","externalArc").each(function(t,e){var a=/(^.+?)L/.exec(u.select(this).attr("d"))[1];if(a=a.replace(/,/g," "),t.endAngle>180*Math.PI/180){var r=/0 0 1 (.*?)$/.exec(a)[1],n=/M(.*?)A/.exec(a)[1];a="M"+r+"A"+/A(.*?)0 0 1/.exec(a)[1]+"0 0 0 "+n}i.append("path").attr("class","hiddenArcs").attr("id","hiddenArc"+e).attr("d",a).style("fill","none")}),i.selectAll(".externalText").data(o(Array.from(radar.areas.values()))).enter().append("text").attr("class","externalText").attr("dy",function(t){return t.endAngle>2.5*Math.PI/180?15:-8}).append("textPath").attr("startOffset","50%").style("text-anchor","middle").attr("xlink:href",function(t,e){return"#hiddenArc"+e}).text(function(t){return t.data})}(),function(){var t=s/2-f/3/2,e=c/2+4,a=u.select("#radar").append("g").attr("id","levels").attr("transform","translate("+c/2+",-"+s/2+")rotate(-270)");a.append("circle").attr("cx",t).attr("cy",e-4).attr("r","12px").attr("fill","#fff"),a.append("text").attr("id","level2").attr("class","levels").attr("width",f).attr("text-anchor","middle").attr("x",t).attr("y",e).text("2");var r=s/2-f/2+8,n=c/2+4;a.append("circle").attr("cx",r).attr("cy",n-4).attr("r","12px").attr("fill","#fff"),a.append("text").attr("id","level1").attr("class","levels").attr("width",f).attr("text-anchor","middle").attr("x",r).attr("y",n).text("1");var i=s/2-f/6*5+8,o=c/2+4;a.append("circle").attr("cx",i).attr("cy",o-4).attr("r","12px").attr("fill","#fff"),a.append("text").attr("id","level0").attr("class","levels").attr("width",f).attr("text-anchor","middle").attr("x",i).attr("y",o).text("0")}()},t.paintPoints=function(t,e){i=e;var a=t.params.teamName?t.params.teamName:Object.keys(e)[0];w(a,i),function(e,t){u.select("#selectTeams").append("select").attr("id","dropDownTeams").attr("class","dropDownTeams").on("change",b).selectAll("option").data(Object.keys(t)).enter().append("option").property("selected",function(t){return t===e}).text(function(t){return t})}(a,i),u.queue().defer(u.json,t.questionsjson).defer(function(t){t(null,a)}).await(y)},t.handleClientLoad=function(){var t={questionsjson:"data/questions.json",params:{teamName:radar.getParameterByName("teamName")}};radar.loadData(t)},t.getParameterByName=function(t,e){e=e||window.location.href,t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},t.random=function(){var t=1e4*Math.sin(D++);return t-Math.floor(t)},Object.defineProperty(t,"__esModule",{value:!0})});